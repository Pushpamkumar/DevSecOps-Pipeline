# Configuration for Secure ML Service# Docker Compose Configuration































































# - Never store passwords in plain text# - Rotate secrets regularly# - Use secure secret management (Vault, AWS Secrets Manager, etc.)# - Never commit actual secrets, only example values# Notes:EMAIL_ALERTS=security-team@company.comSLACK_WEBHOOK_URL=# Notification (Optional)BANDIT_ENABLED=trueANCHORE_ENABLED=trueTRIVY_ENABLED=true# Security ScanningCI_REGISTRY_EMAIL=your-email@company.comCI_REGISTRY_PASSWORD=your-passwordCI_REGISTRY_USER=your-username# CI/CD ConfigurationIMAGE_TAG=latestIMAGE_NAME=ml-serviceREGISTRY_URL=ghcr.io# Docker & RegistrySENTRY_DSN=PROMETHEUS_PORT=8001PROMETHEUS_ENABLED=true# MonitoringMODEL_TIMEOUT=30MODEL_PATH=/app/models/model.joblib# Model ConfigurationLOG_FORMAT=jsonLOG_LEVEL=INFO# Logging Configuration# DB_PASSWORD=change-this# DB_USER=admin# DB_NAME=ml-service# DB_PORT=5432# DB_HOST=localhost# Database Configuration (if using)JWT_SECRET=change-this-to-secure-valueAPI_KEY=your-api-key-hereSECRET_KEY=change-this-to-a-secure-random-key# Security ConfigurationMAX_BATCH_SIZE=1000MAX_FEATURES=100API_HOST=0.0.0.0API_PORT=5000# API ConfigurationPYTHONUNBUFFERED=1FLASK_DEBUG=0FLASK_ENV=production# Application Configuration# Copy to .env and fill in your values# Runs both secure and insecure ML service containers for comparison

version: "3.8"

services:
  # Secure ML Service
  ml-service-secure:
    build:
      context: .
      dockerfile: docker/Dockerfile.secure
    container_name: ml-service-secure
    ports:
      - "5001:5000"
    environment:
      - FLASK_ENV=production
      - PYTHONUNBUFFERED=1
    # Security configurations
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    cap_add:
      - NET_BIND_SERVICE
    read_only: true
    tmpfs:
      - /tmp
      - /var/tmp
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    networks:
      - ml-network
    labels:
      - "app.version=1.0"
      - "security.scanning=enabled"
      - "compliance.status=pass"

  # Insecure ML Service (for demonstration)
  ml-service-insecure:
    build:
      context: .
      dockerfile: docker/Dockerfile.insecure
    container_name: ml-service-insecure
    ports:
      - "5000:5000"
      - "22:22"
      - "80:80"
    environment:
      - FLASK_ENV=development
    # No security configurations - intentionally insecure
    restart: no
    # No health check
    # No logging configuration
    networks:
      - ml-network
    labels:
      - "app.version=1.0"
      - "security.scanning=disabled"
      - "compliance.status=fail"
      - "purpose=demonstration"

networks:
  ml-network:
    driver: bridge
    name: ml-services-network

volumes:
  model-storage:
    driver: local

# Usage:
# docker-compose build                    # Build both images
# docker-compose up -d                    # Start both services
# docker-compose logs ml-service-secure   # View secure service logs
# docker-compose logs ml-service-insecure # View insecure service logs
# docker-compose down                     # Stop both services
#
# Test endpoints:
# Secure:   curl http://localhost:5001/health
# Insecure: curl http://localhost:5000/health
